<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Resolviendo Ecuaciones Paso a Paso</title>
    <!-- KaTeX CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
    <!-- KaTeX JS -->
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
    <!-- Auto-render extension -->
    <script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/contrib/auto-render.min.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f0f8ff;
            padding: 20px;
        }
        h2, h3 {
            color: #004080;
        }
        .equation-container {
            margin-top: 20px;
            padding: 20px;
            background-color: #e6f2ff;
            border-radius: 10px;
        }
        .equation {
            font-size: 20px;
            font-weight: bold;
        }
        .step-container {
            margin-top: 10px;
            padding: 10px;
            background-color: #ffffff;
            border: 2px solid #cce7ff;
            border-radius: 10px;
        }
        .step-container button {
            padding: 8px 16px;
            font-size: 16px;
            cursor: pointer;
            background-color: #0066cc;
            color: white;
            border: none;
            border-radius: 5px;
            margin-top: 10px;
        }
        .step-container button:hover {
            background-color: #004080;
        }
        .hint {
            color: #ff6600;
            margin-top: 10px;
        }
        .correct {
            color: green;
            font-weight: bold;
            margin-top: 10px;
        }
        .incorrect {
            color: red;
            font-weight: bold;
            margin-top: 10px;
        }
        #completionMessage {
            font-size: 20px;
            color: #004080;
            margin-top: 30px;
        }
        .option {
            margin: 10px 0;
        }
        input[type="number"], input[type="text"] {
            width: 60px;
            padding: 5px;
            font-size: 16px;
            text-align: center;
        }
    </style>
</head>
<body>
    <h2>Resolviendo Ecuaciones Paso a Paso</h2>
    <div id="equationContainer"></div>
    <div id="completionMessage"></div>

    <script>
        const equations = [
            {
                equation: "\\(17 + (o + 74) = (74 + 17) + 6\\)",
                steps: [
                    {
                        prompt: "Simplifica el lado izquierdo:",
                        type: "select",
                        options: ["\\(o + 91\\)", "\\(o + 57\\)", "\\(o + 107\\)"],
                        correctOption: 0,
                        hints: [
                            "Suma 17 y 74.",
                            "17 + 74 = 91.",
                            "Entonces, el lado izquierdo es \\(o + 91\\)."
                        ]
                    },
                    {
                        prompt: "Simplifica el lado derecho:",
                        type: "select",
                        options: ["\\(97\\)", "\\(91\\)", "\\(87\\)"],
                        correctOption: 0,
                        hints: [
                            "Suma 74 y 17.",
                            "74 + 17 = 91.",
                            "Ahora suma 91 + 6.",
                            "91 + 6 = 97."
                        ]
                    },
                    {
                        prompt: "Escribe la nueva ecuación simplificada:",
                        type: "select",
                        options: ["\\(o + 91 = 97\\)", "\\(o + 74 = 97\\)", "\\(o + 91 = 91\\)"],
                        correctOption: 0,
                        hints: [
                            "El lado izquierdo es \\(o + 91\\) y el derecho es 97.",
                            "La ecuación es \\(o + 91 = 97\\)."
                        ]
                    },
                    {
                        prompt: "¿Qué operación realizamos para despejar \( o \)?",
                        type: "select",
                        options: ["Restar 91 en ambos lados", "Sumar 91 en ambos lados", "Dividir ambos lados entre 91"],
                        correctOption: 0,
                        hints: [
                            "Queremos aislar \( o \).",
                            "Como está sumando 91, restamos 91 en ambos lados."
                        ]
                    },
                    {
                        prompt: "Calcula el valor de \( o \): \( o = 97 - 91 = \)",
                        type: "input",
                        correctAnswer: "6",
                        hints: [
                            "97 - 91 = 6.",
                            "Entonces, \( o = 6 \)."
                        ]
                    }
                ]
            },
            // Añade más ecuaciones siguiendo el mismo formato...
            {
                equation: "\\(27 + 24 = 24 + e\\)",
                steps: [
                    {
                        prompt: "Simplifica el lado izquierdo:",
                        type: "input",
                        correctAnswer: "51",
                        hints: [
                            "Suma 27 y 24.",
                            "27 + 24 = 51."
                        ]
                    },
                    {
                        prompt: "Simplifica el lado derecho:",
                        type: "select",
                        options: ["\\(24 + e\\)", "\\(e + 24\\)", "\\(27 + e\\)"],
                        correctOption: 0,
                        hints: [
                            "El lado derecho ya está simplificado.",
                            "Es \\(24 + e\\)."
                        ]
                    },
                    {
                        prompt: "Escribe la nueva ecuación simplificada:",
                        type: "select",
                        options: ["\\(51 = 24 + e\\)", "\\(51 = 27 + e\\)", "\\(51 = e + 27\\)"],
                        correctOption: 0,
                        hints: [
                            "El lado izquierdo es 51 y el derecho es \\(24 + e\\).",
                            "Entonces, \\(51 = 24 + e\\)."
                        ]
                    },
                    {
                        prompt: "¿Qué operación realizamos para despejar \( e \)?",
                        type: "select",
                        options: ["Restar 24 en ambos lados", "Sumar 24 en ambos lados", "Multiplicar ambos lados por 24"],
                        correctOption: 0,
                        hints: [
                            "Queremos aislar \( e \).",
                            "Como está sumando 24, restamos 24 en ambos lados."
                        ]
                    },
                    {
                        prompt: "Calcula el valor de \( e \): \( e = 51 - 24 = \)",
                        type: "input",
                        correctAnswer: "27",
                        hints: [
                            "51 - 24 = 27.",
                            "Entonces, \( e = 27 \)."
                        ]
                    }
                ]
            },
            // Continúa agregando las demás ecuaciones aquí...
        ];

        let currentEquationIndex = 0;
        let currentStepIndex = 0;
        let hintIndex = 0;

        function renderCurrentStep() {
            const equationContainer = document.getElementById('equationContainer');

            // Limpiar el contenido previo si es una nueva ecuación
            if (currentStepIndex === 0) {
                equationContainer.innerHTML = '';
            }

            if (currentEquationIndex >= equations.length) {
                document.getElementById('completionMessage').innerHTML = "¡Has completado todas las ecuaciones! ¡Buen trabajo!";
                return;
            }

            const currentEquation = equations[currentEquationIndex];
            const currentStep = currentEquation.steps[currentStepIndex];

            // Mostrar la ecuación original si es el primer paso
            if (currentStepIndex === 0) {
                const equationDiv = document.createElement('div');
                equationDiv.className = 'equation-container';
                equationDiv.id = 'equation-' + currentEquationIndex;
                equationDiv.innerHTML = `<div class="equation">Ecuación: ${currentEquation.equation}</div>`;
                equationContainer.appendChild(equationDiv);
            }

            const stepDiv = document.createElement('div');
            stepDiv.className = 'step-container';
            stepDiv.id = `step-${currentEquationIndex}-${currentStepIndex}`;

            const prompt = document.createElement('p');
            prompt.innerHTML = currentStep.prompt;
            stepDiv.appendChild(prompt);

            let inputElement;

            if (currentStep.type === 'select') {
                inputElement = document.createElement('div');
                currentStep.options.forEach((optionText, index) => {
                    const optionDiv = document.createElement('div');
                    optionDiv.className = 'option';
                    optionDiv.innerHTML = `
                        <input type="radio" name="answer-${currentEquationIndex}-${currentStepIndex}" id="option${index}" value="${index}">
                        <label for="option${index}">${optionText}</label>
                    `;
                    inputElement.appendChild(optionDiv);
                });
            } else if (currentStep.type === 'input') {
                inputElement = document.createElement('div');
                inputElement.innerHTML = `<input type="${isNaN(currentStep.correctAnswer) ? 'text' : 'number'}" id="userInput-${currentEquationIndex}-${currentStepIndex}">`;
            }

            stepDiv.appendChild(inputElement);

            const checkButton = document.createElement('button');
            checkButton.innerHTML = 'Comprobar';
            checkButton.onclick = function() { checkAnswer(currentEquationIndex, currentStepIndex); };
            stepDiv.appendChild(checkButton);

            const feedbackDiv = document.createElement('div');
            feedbackDiv.id = `feedback-${currentEquationIndex}-${currentStepIndex}`;
            stepDiv.appendChild(feedbackDiv);

            equationContainer.appendChild(stepDiv);

            renderMathInElement(equationContainer, {
                delimiters: [
                    {left: "\\(", right: "\\)", display: false},
                    {left: "\\[", right: "\\]", display: true}
                ]
            });
        }

        function checkAnswer(equationIndex, stepIndex) {
            const feedbackDiv = document.getElementById(`feedback-${equationIndex}-${stepIndex}`);
            const currentEquation = equations[equationIndex];
            const currentStep = currentEquation.steps[stepIndex];

            let userAnswer;

            if (currentStep.type === 'select') {
                const selectedOption = document.querySelector(`input[name="answer-${equationIndex}-${stepIndex}"]:checked`);
                if (selectedOption) {
                    userAnswer = parseInt(selectedOption.value);
                } else {
                    feedbackDiv.innerHTML = '<span class="incorrect">Por favor, selecciona una opción.</span>';
                    return;
                }
            } else if (currentStep.type === 'input') {
                userAnswer = document.getElementById(`userInput-${equationIndex}-${stepIndex}`).value.trim();
                if (userAnswer === '') {
                    feedbackDiv.innerHTML = '<span class="incorrect">Por favor, ingresa tu respuesta.</span>';
                    return;
                }
            }

            let isCorrect = false;

            if (currentStep.type === 'select') {
                isCorrect = userAnswer === currentStep.correctOption;
            } else if (currentStep.type === 'input') {
                isCorrect = userAnswer === currentStep.correctAnswer;
            }

            if (isCorrect) {
                feedbackDiv.innerHTML = '<span class="correct">¡Correcto!</span>';
                hintIndex = 0;
                currentStepIndex++;

                if (currentStepIndex >= currentEquation.steps.length) {
                    // Ocultar la ecuación actual
                    setTimeout(() => {
                        const equationDiv = document.getElementById('equation-' + equationIndex);
                        equationDiv.style.display = 'none';
                        currentEquationIndex++;
                        currentStepIndex = 0;
                        renderCurrentStep();
                    }, 2000);
                } else {
                    renderCurrentStep();
                }
            } else {
                if (hintIndex < currentStep.hints.length) {
                    feedbackDiv.innerHTML = `<span class="hint">Pista: ${currentStep.hints[hintIndex]}</span>`;
                    hintIndex++;
                } else {
                    let correctResponse = '';
                    if (currentStep.type === 'select') {
                        correctResponse = currentStep.options[currentStep.correctOption];
                    } else if (currentStep.type === 'input') {
                        correctResponse = currentStep.correctAnswer;
                    }
                    feedbackDiv.innerHTML = `<span class="incorrect">Respuesta incorrecta. La respuesta correcta es: ${correctResponse}</span>`;
                    hintIndex = 0;
                    currentStepIndex++;
                    if (currentStepIndex >= currentEquation.steps.length) {
                        // Ocultar la ecuación actual
                        setTimeout(() => {
                            const equationDiv = document.getElementById('equation-' + equationIndex);
                            equationDiv.style.display = 'none';
                            currentEquationIndex++;
                            currentStepIndex = 0;
                            renderCurrentStep();
                        }, 4000);
                    } else {
                        renderCurrentStep();
                    }
                }
            }

            renderMathInElement(feedbackDiv, {
                delimiters: [
                    {left: "\\(", right: "\\)", display: false},
                    {left: "\\[", right: "\\]", display: true}
                ]
            });
        }

        // Iniciar el juego
        renderCurrentStep();
    </script>
    <!-- KaTeX Auto-render -->
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            renderMathInElement(document.body, {
                delimiters: [
                    {left: "\\(", right: "\\)", display: false},
                    {left: "\\[", right: "\\]", display: true}
                ]
            });
        });
    </script>
</body>
</html>
